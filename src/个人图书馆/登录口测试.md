### 登录口测试

#### 任意用户登录

* 伪造返回数据包
  * 无效，而且响应内容没什么价值
* 伪造cookie

#### 验证码相关

* 验证码登录
  * 任意验证码 ×
  * 验证码泄露（返回前端）存疑，需仔细排查js ×
  * 前段验证 存疑，实验成功，需要排查是否是cookie的原因
    * 是cookie原因 危害低很多（在已经曾经登陆过的设备上可以指定账号登录）
  * 可篡改手机号 
  * 使用其他手机号的验证码 ×
  * 验证码爆破
  * 短信纵向轰炸
    * 搞清签名过程，是否可以伪造签名
  * 其他问题和发现：
    * 多个验证码  多个未使用的验证码相同 ×
    * 验证码反复使用    ×
    * 发现一个检查手机号是否注册的接口/ajax/CheckLoginName1.ashx 是否可以遍历注册手机号 √
    * 验证码登录时使用的登录接口/ajax/login/paylogin.ashx是否可以伪造

#### cookie相关

* LoginName、360doc2、360doc1、360doc12

* 在对接口/ajax/EditUsersInfo.ashx的测试过程中发现，cookie中只有360doc1、360doc20影响鉴权，而且这两者的值相等

* <u>note</u> 发现一个账号相隔一周左右登录，其cookie的核心部分相同
  
  * TODO 退出登录是否有效？
  
  * TODO cookie是否有规律可破解

#### 思路拓展

* 心跳包和第二个登录包中都有JSONP的用法，注意心跳包有没有JSONP劫持可用，注意callback的函数的作用
  * 第二个登录包的响应没有什么敏感信息
  * TODO
* www.和pay.两个host，使用相同的cookie

#### 爆破相关

### 个人页面

#### 个人资料

* 用户名xss，但是长度限制为14，暂不知如何利用
* 直接发包可突破用户重名
  * 是否重名后是否可以任意登录——不行

### JS相关

### 对请求包中sign的分析

#### 初步分析

* 使用sign防止篡改数据包
  
  * 随意修改了一下http请求的cookie（非核心部分）、origin，仍可通过请求
  * 修改body部分的任意数据无法通过请求

#### 逆向JS

* 这里以他修改个人信息处的功能开始逆向

* f12查看器直接发现了提交按钮对应的event

* 一层层分析代码
  
  * 有混淆，暂略

* ，后面故意填被限制的用户名，调试发现了进行md5的JavaScript脚本

```txt
'360doc&city=国家-省/市-城市&sex=2&name=abcdefgggggg&content=2008&photo=http://pubimage.360doc.com/head/ancient/001.gif&age=****-**-**'
"360docage=****-**-**city=国家-省/市-城市content=1999name=master666photo=http://pubimage.360doc.com/head/ancient/001.gifsex=2"
```

```javascript
String.prototype.trim = function () {
  return this.replace(/(^\s*)|(\s*$)/g, '')
};
var userinfo = {
  CurNickName: '',
  oldMyTags: '',
  init: function () {
    var strYear = '';
    var dd = new Date();
    var strYear = dd.getFullYear();
    for (var i = strYear; i > 1900; i--) {
      $('#year').append('<option value="' + i + '">' + i + '</option>')
    }
    for (var i = 1; i < 13; i++) {
      if (i < 10) {
        $('#month').append('<option value="0' + i + '">0' + i + '</option>')
      } else {
        $('#month').append('<option value="' + i + '">' + i + '</option>')
      }
    }
    for (var i = 1; i <= 31; i++) {
      if (i < 10) {
        $('#day').append('<option value="0' + i + '">0' + i + '</option>')
      } else {
        $('#day').append('<option value="' + i + '">' + i + '</option>')
      }
    }
  },
  togglecss: function () {
    $('.erjibt').mouseover(
      function () {
        $(this).removeClass('erjibt').addClass('erjibta')
      }
    ).mouseout(
      function () {
        $(this).removeClass('erjibta').addClass('erjibt')
      }
    )
  },
  HideFinishEditor: function () {
    var obj3 = document.getElementById('Face');
    if (obj3 != null) {
      obj3.style.display = 'none'
    }
  },
  OnShowUserParticularInfo: function (result) {
    if (result[0].NickName == '非法操作！') {
      alert(result[0].NickName)
    } else {
      var strdescription = decodeURIComponent(result[0].Description);
      var strUserAge = result[0].UserAge.split('-');
      var strCity = result[0].City.split('-');
      var strPhoto = result[0].UserPhoto;
      if (strdescription == null) {
        strdescription = ''
      }
      strdescription = strdescription.replace(/<BR>/g, '\r\n');
      strdescription = strdescription.replace(/<br>/g, '\r\n');
      strdescription = strdescription.replace(/<Br>/g, '\r\n');
      strdescription = strdescription.replace(/&nbsp;/g, ' ');
      strdescription = userinfo.htmlDecode(strdescription);
      $('#txtNickName').val(result[0].NickName);
      $('#hidnickname').val(result[0].NickName);
      this.CurNickName = $('#txtNickName').val();
      $('#txtQQ').val(result[0].QQ);
      $('#txtContent').val(strdescription);
      $('#FacePic100').attr('src', result[0].UserPhoto);
      $('#FacePic50').attr('src', result[0].smallPhoto);
      $('#imgsrc').val(strPhoto);
      $('#divcreatetime').html(result[0].CreateDate);
      if (result[0].truename != '') {
        $('#truename').css('color', '#000');
        $('#truename').val(result[0].truename)
      }
      $.ajax({
        url: '/ajax/valideUser.ashx?userid=' + $('#userid').val() + '&type=2',
        dataType: 'html',
        cache: false,
        success: function (result) {
          if (result == '-100') {
            $('#divmobi').html(
              '根据国家实名制法规要求，<br>请尽快进行<a href="javascript:void(0)" onclick="parent.certification=2;parent.document.getElementById(\'auservalide\').click();" style="font-weight: bold;">手机验证</a>'
            );
            $('#divmobi').show()
          }
        },
        error: this.errorTip
      });
      var form = document.aspnetForm;
      setup();
      if (result[0].UserGender == '1') {
        $('#nan').attr('checked', 'checked')
      } else if (result[0].UserGender == '2') {
        $('#nv').attr('checked', 'checked')
      } else {
      }
      $('#year ').val(strUserAge[0]);
      $('#month ').val(strUserAge[1]);
      $('#day ').val(strUserAge[2]);
      $('#s1 ').val(strCity[0]);
      change(1);
      $('#s2 ').val(strCity[1]);
      change(2);
      $('#s3 ').val(strCity[2])
    }
  },
  getmyusertags: function () {
    $.ajax({
      url: '/ajax/getmyuertags.ashx',
      dataType: 'html',
      cache: false,
      success: function (result) {
        if (result != '') {
          $('#tdtags').html(
            '<div class="left"><span id="spantags" title="我的兴趣词">' + result + '</span>&nbsp;&nbsp;&nbsp;</div>'
          )
        } else {
          $('#tdtags').html(
            '<div class="exitxingqu"><a href="javascript:void(0);" onclick="userinfo.showeditmyusertagsdiv();">添加兴趣词</a></div>'
          )
        }
      },
      error: this.errorTip
    })
  },
  showeditmyusertagsdiv: function () {
    if ($('#is64').val() == '1') {
      return
    }
    var strtags = $('#hidmytags').val();
    if (strtags == null) strtags = '';
    $('#tdtags').html(
      '<div style="float: left;"><input id="txtmytags"class="zcbasicinput"type="text"size="25"/>（词与词以空格相隔）</div><div class="xingqubutton"><a href="javascript:userinfo.editmyusertags()"class="rbtn_confirm_s f_left">确定</a><a href="javascript:userinfo.getmyusertags()"class="rbtn_cancel_s f_left"style="margin-left: 20px;">取消</a></div>'
    );
    $('.erjibt').mouseover(
      function () {
        $(this).removeClass('erjibt').addClass('erjibta')
      }
    ).mouseout(
      function () {
        $(this).removeClass('erjibta').addClass('erjibt')
      }
    );
    this.oldMyTags = strtags;
    $('#txtmytags').val(strtags)
  },
  editmyusertags: function () {
    var strtags = $('#txtmytags').val();
    if (this.oldMyTags != undefined && strtags == this.oldMyTags) {
      userinfo.getmyusertags();
      return
    }
    $.ajax({
      type: 'POST',
      url: '/ajax/editmyusertags.ashx',
      dataType: 'html',
      cache: false,
      data: 'tags=' + escape(strtags) + '',
      success: function (result) {
        if (result != '' && result != '-1') {
          alert(result)
        } else {
          if (result == '-1') {
            alert('兴趣词最多只能填写三个词')
          }
          userinfo.getmyusertags()
        }
      },
      error: this.errorTip
    })
  },
  ShowFaceDiv: function () {
    $('#Face').show();
    userinfo.changespan('qh', 0)
  },
  ChangePic: function (id, type) {
    $.ajax({
      type: 'POST',
      url: '/ajax/ChangeUserHeadImage.ashx',
      cache: false,
      dataType: 'html',
      data: 'id=' + id + '&type=' + type + '',
      success: function (result) {
        if (result != null) {
          result = JSON.parse(result);
          if (result.status == '1') {
            $('#Face').hide();
            $('#FacePic100').attr('src', result.strsrc);
            $('#imgsrc').attr('src', result.strsrc);
            $('#FacePic50').attr('src', result.strsmallsrc);
            $('#imgUserPhoto', parent.document).attr('src', result.strsrc)
          } else {
            alert(result.message)
          }
        }
      },
      error: this.errorTip
    })
  },
  insertPic: function () {
    var folder = '/img';
    FTB_HelperFilesPath = '/HelperScripts/';
    var galleryscript = 'ftb.imagegallery.aspx?rif=' + folder + '&cif=' + folder;
    var imgArr;
    var reWork = new RegExp('object', 'gi');
    window.open(
      galleryscript,
      'newWin',
      'top=' + (screen.height - 300) / 2 + ',left=' + (screen.width - 300) / 2 + ',toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=724,height=650'
    );
    if (!reWork.test(String(reWork))) {
      alert('弹出窗口被拦截！\r\n请设定你安装的拦截弹出窗口软件，使当前页面不被拦截！');
      return
    }
  },
  insertPicUpload: function () {
    var uiUpload = $('#UserCHead_Upload', window.parent.document);
    if (
      navigator.userAgent.indexOf('compatible') > - 1 &&
      navigator.userAgent.indexOf('MSIE') > - 1 &&
      !window.File
    ) {
      uiUpload.html(
        '<iframe src="/pages/UpUPhotoFrame.html" frameborder="0" scrolling="no" width="404" height="408"></iframe>'
      )
    } else {
      uiUpload.html(
        '<iframe src="/pages/UpUPhotoFrame2.html" frameborder="0" scrolling="no" width="404" height="408"></iframe>'
      )
    };
    uiUpload.fadeIn(100)
  },
  insertPicAlbum: function () {
    var uiAlbum = $('#UserCHead_HList', window.parent.document);
    uiAlbum.html(
      '<iframe src="/pages/UPhotoAlbumFrame.html" frameborder="0" scrolling="no" width="483" height="530"></iframe>'
    );
    uiAlbum.fadeIn(100)
  },
  updateUserInfo: function () {
    $('#aUpdateUserInfo').attr('onclick', '');
    strDescription = $('#txtContent').val().trim();
    if (strDescription.indexOf('http:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写网址！');
      return
    }
    if (strDescription.indexOf('https:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写网址！');
      return
    }
    if (strDescription.indexOf('www.') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写网址！');
      return
    }
    if (strDescription.indexOf('qq:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写QQ号码！');
      return
    }
    if (strDescription.indexOf('qq：') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写QQ号码！');
      return
    }
    if (strDescription.indexOf('QQ:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写QQ号码！');
      return
    }
    if (strDescription.indexOf('QQ：') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写QQ号码！');
      return
    }
    if (strDescription.indexOf('电话:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写电话号码！');
      return
    }
    if (strDescription.indexOf('电话：') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写电话号码！');
      return
    }
    if (strDescription.indexOf('TEL:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写电话号码！');
      return
    }
    if (strDescription.indexOf('TEL：') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写电话号码！');
      return
    }
    if (strDescription.indexOf('卡号:') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写银行卡号！');
      return
    }
    if (strDescription.indexOf('卡号：') >= 0) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能填写银行卡号！');
      return
    }
    if (strDescription.replace(/[^\x00-\xff]/g, '**').length > 200) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert('个人简介不能超过100个字，请精简文字后再修改！');
      return
    }
    var patrn = /^[0-9]*$/;
    if (
      $('#txtQQ').val().trim() != '' &&
      patrn.exec($('#txtQQ').val().trim()) == null
    ) {
      $('#msgQQ').html('<span class="zcsuccedbja">请正确输入QQ号！</span>');
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      return
    } else if ($('#txtNickName').val().trim() == '') {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      window.parent.scrollToFixBar(1);
      alert('馆名不能为空！');
      return
    } else if (!userinfo.isNickname($('#txtNickName').val().trim())) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      window.parent.scrollToFixBar(1);
      alert('馆名仅可使用汉字、数字、字母和下划线！');
      return
    } else if (
      $('#txtNickName').val().replace(/[^\x00-\xff]/g, '**').length > 14
    ) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      window.parent.scrollToFixBar(1);
      alert('馆名最长14个英文或者7个汉字！');
      return
    } else if ($('#truename').val().replace(/[^\x00-\xff]/g, '**').length > 30) {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      window.parent.scrollToFixBar(1);
      alert('真实姓名最长30个英文或者15个汉字！');
      return
    } else if ($('#txtNickName').val().trim() != '') {
      $.ajax({
        url: '/ajax/CheckName.ashx?name=' + encodeURI($('#txtNickName').val().trim()) + '&type=1',
        cache: false,
        dataType: 'html',
        success: function (result) {
          if (result != '') {
            $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
            window.parent.scrollToFixBar(1);
            alert(result);
            return
          } else {
            userinfo.updateUser()
          }
        },
        error: this.errorTip
      })
    }
  },
  updateUser: function () {
    var form = document.aspnetForm;
    var strsex = '';
    if ($('#nan').prop('checked')) {
      strsex = 1
    } else {
      strsex = 2
    }
    var strCity = $('#s1').val() + '-' + $('#s2').val() + '-' + $('#s3').val();
    var strUserGender = strsex;
    var strNickName = $('#txtNickName').val().trim();
    var strDescription = $('#txtContent').val().trim();
    var strUserPhoto = $('#imgsrc').val();
    var strUserAge = $('#year').val() + '-' + $('#month').val() + '-' + $('#day').val();
    var strQQ = $('#txtQQ').val().trim();
    var strTrueName = $('#truename').val();
    if (strTrueName == ' 仅自己可见') {
      strTrueName = ''
    }
    var sign = this.yacode.scode(
      '360doc&city=' + strCity + '&sex=' + strUserGender + '&name=' + strNickName + '' + (strDescription != '' ? '&content=' + strDescription : '') + '' + (strUserPhoto != '' ? '&photo=' + strUserPhoto : '') + (strUserAge != '' ? '&age=' + strUserAge : '') + (strQQ != '' ? '&qq=' + strQQ : '') + (strTrueName != '' ? '&truename=' + strTrueName : '')
    );
    var usercode = getCookie('360doc1');
    usercode = usercode == null ||
    usercode == '' ? - 1 : usercode;
    $.ajax({
      url: '/ajax/EditUsersInfo.ashx',
      type: 'post',
      dataType: 'json',
      data: 'city=' + encodeURI(strCity) + '&sex=' + strUserGender + '&name=' + encodeURI(strNickName) + '&content=' + encodeURIComponent(strDescription) + '&photo=' + encodeURI(strUserPhoto) + '&age=' + encodeURI(strUserAge) + '&qq=' + encodeURI(strQQ) + '&truename=' + encodeURI(strTrueName) + '&sign=' + sign,
      success: function (result) {
        if (result.status == 1) {
          $('#divuserinfoMsg').html('<font color=\'#008000\'>修改成功！</font>');
          setTimeout(
            function () {
              top.document.location.href = 'http://www.360doc.com/myaccount.aspx?app=2'
            },
            1000
          )
        } else {
          if (result.status == - 1) {
            $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
            alert(result.msg)
          } else {
            $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
            alert('操作错误！')
          }
        }
      },
      error: function () {
        $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
        alert('操作错误！')
      }
    })
  },
  OnUpdateUserInfo: function (result) {
    if (result == '') {
      $('#divuserinfoMsg').html('<font color=\'#008000\'>修改成功！</font>');
      setTimeout(
        function () {
          top.document.location.href = 'http://www.360doc.com/myaccount.aspx?app=2'
        },
        1000
      )
    } else {
      $('#aUpdateUserInfo').attr('onclick', 'userinfo.updateUserInfo();');
      alert(result)
    }
  },
  closeuserinfo: function () {
    setTimeout('window.top.myindex111();', 100)
  },
  checkQQ: function () {
    var patrn = /^[0-9]*$/;
    var strQQ = $('#txtQQ').val().trim();
    if (strQQ != '' && patrn.exec(strQQ) == null) {
      $('#msgQQ').html('<span class="zcsuccedbja">请正确输入QQ号！</span>')
    } else {
      if (strQQ != '') {
        $('#msgQQ').html(
          '<div  class="zcduigou">&nbsp;&nbsp;<img src="http://pubimage.360doc.com/duigou.gif" width="17" height="13" /></div>'
        )
      } else {
        $('#msgQQ').html('')
      }
    }
  },
  OncheckName: function (result) {
    if (result != '') {
      if (result.indexOf('已被注册') >= 0) {
        $('#nicknameerror').html('该馆名已被注册，换一个吧！')
      } else {
        $('#nicknameerror').html(result)
      }
    } else {
      $('#nicknameerror').html('')
    }
  },
  changespan: function (pro_name, i) {
    var pro = document.getElementById(pro_name);
    var headname = 'http://pubimage.360doc.com/head';
    var pro_arr = pro.getElementsByTagName('div');
    for (var m = 0; m < pro_arr.length; m++) {
      pro_arr[m].className = ''
    }
    pro_arr[i].className = 'checked';
    if (i == 1) {
      headname += '/papercut'
    }
    if (i == 2) {
      headname += '/ancient'
    }
    if (i == 3) {
      headname += '/wash'
    }
    if (i == 4) {
      headname += '/mask'
    }
    if (i == 5) {
      headname += '/cartoon'
    }
    $('#' + pro_name + '_ul_0').html(
      '<div class="touxmr"><table cellpadding="0" cellspacing="0"><tr><td width="105" style="text-align:center;"><div onclick="userinfo.ChangePic(\'001\',' + i + ')"><img height="80" src="' + headname + '/001.gif" /></div></td><td width="105" style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'002\',' + i + ')"><img height="80" src="' + headname + '/002.gif" /></div></td><td width="105" style="text-align:center;"><div class="mren1" onclick="userinfo.ChangePic(\'003\',' + i + ')"><img height="80" src="' + headname + '/003.gif" /></div></td></tr><tr><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'004\',' + i + ')"><img height="80" src="' + headname + '/004.gif" /></div></td><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'005\',' + i + ')"><img height="80" src="' + headname + '/005.gif" /></div></td><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'006\',' + i + ')"><img height="80" src="' + headname + '/006.gif" /></div></td></tr><tr><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'007\',' + i + ')"><img height="80" src="' + headname + '/007.gif" /></div></td><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'008\',' + i + ')"><img height="80" src="' + headname + '/008.gif" /></div></td><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'009\',' + i + ')"><img height="80" src="' + headname + '/009.gif" /></div></td></tr><tr><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'010\',' + i + ')"><img height="80" src="' + headname + '/010.gif" /></div></td><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'011\',' + i + ')"><img height="80" src="' + headname + '/011.gif" /></div></td><td style="text-align:center;"><div class="mren2" onclick="userinfo.ChangePic(\'012\',' + i + ')"><img height="80" src="' + headname + '/012.gif" /></div></td></tr></table></div>'
    );
    $('#' + pro_name + '_ul_0').show();
    $('.touxmr table div').mouseover(
      function () {
        $(this).css('cursor', 'pointer');
        $(this).removeClass();
        $(this).addClass('mren1')
      }
    );
    $('.touxmr table div').mouseout(function () {
      $(this).removeClass();
      $(this).addClass('mren2')
    })
  },
  errorTip: function (error) {
  },
  isNickname: function (value) {
    var patrn = /^[a-zA-Z0-9_\u4e00-\u9fa5]+$/;
    var oldname = $('#hidnickname').val();
    if (!patrn.exec(value)) {
      if (oldname != value) {
        return false
      } else {
        return true
      }
    } else {
      return true
    }
  },
  endWithCG: function (CurString, oString) {
    var reg = new RegExp(oString + '$');
    return reg.test(CurString)
  },
  checkName: function () {
    if ($('#txtNickName').val().trim() == '') {
      $('#nicknameerror').html('馆名不能为空！')
    } else if (!userinfo.isNickname($('#txtNickName').val().trim())) {
      $('#nicknameerror').html('仅可使用汉字、数字、字母和下划线！')
    } else if (
      $('#txtNickName').val().trim().replace(/[^\x00-\xff]/g, '**').length > 14
    ) {
      $('#nicknameerror').html('最长14个英文或者7个汉字！')
    } else if (this.CurNickName == $('#txtNickName').val().trim()) {
    } else {
      $.ajax({
        url: '/ajax/CheckName.ashx?name=' + encodeURI($('#txtNickName').val().trim()) + '&type=1',
        dataType: 'html',
        cache: false,
        success: this.OncheckName,
        error: this.errorTip
      })
    }
  },
  htmlDecode: function (text) {
    return text.replace(/&amp;/g, '&').replace(/&quot;/g, '"').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#39;/g, '\'')
  },
  yacode: {
    scode: function (s) {
      s = this.sort(s);
      return escape($.md5(s.toLowerCase()))
    },
    sort: function (Url) {
      var array = Url.split('&');
      array.sort();
      var rel = '';
      for (i = 0; i < array.length; i++) {
        rel += array[i]
      }
      return rel
    }
  }
};
$(document).ready(
  function () {
    userinfo.init();
    $.ajax({
      type: 'GET',
      contentType: 'application/json',
      url: '/ajax/getUserInfo.aspx',
      cache: false,
      dataType: 'json',
      success: userinfo.OnShowUserParticularInfo
    });
    userinfo.getmyusertags();
    userinfo.togglecss();
    document.body.onclick = userinfo.HideFinishEditor;
    if ($('#IsorganizationVerification').val() == '1') {
      if ($('#isChecking').val() == '1') {
        $('#checktips').show();
        $('#txtNickName').hide();
        return
      }
      if ($('#days').val() != '') {
        $('#daytips').show();
        $('#txtNickName').hide();
        return
      }
      $('#updatetips').show()
    } else {
      if ($('#isChecking').val() == '1') {
        $('#checktips').show();
        $('#txtNickName').hide();
        return
      }
    }
    CheckBlackUserUpdate()
  }
);
function getCookie(name) {
  var re = null;
  var curCookie = document.cookie + ';';
  var varName = name + '=';
  var startOfCookie = curCookie.indexOf(varName);
  var endOfCookie;
  if (startOfCookie != - 1) {
    startOfCookie += varName.length;
    endOfCookie = curCookie.indexOf(';', startOfCookie);
    re = unescape(curCookie.substring(startOfCookie, endOfCookie))
  }
  return re
};
function CheckBlackUserUpdate() {
  $.ajax({
    type: 'GET',
    contentType: 'application/json',
    url: '/ajax/getBlackUserUpdate.ashx',
    cache: false,
    dataType: 'json',
    data: {
      updateType: '2'
    },
    success: function (res) {
      if (res.status == '1') {
        var html = '您因违反《<a href="http://www.360doc.com/pages/service.html" target="blank" style="text-decoration: none;color: #ff4800;">个人图书馆服务条款</a>》,';
        html += res.type == '1' ? '已被禁止修改个人资料！禁止期：' + res.startTime + ' 至 ' + res.endTime : '已被永久禁止修改个人资料！';
        $('#blackTipDiv').html(html);
        $('#blackTipDiv').show();
        $('#aUpdateUserInfo').hide();
        $('.tjtx a').hide();
        $('.sctx a').hide();
        $('.tpxz a').hide();
        $('.xiugai a').hide();
        $('.erjibt').hide()
      } else if (res.status != '0') {
        alert(res.message)
      }
    }
  })
}

```

