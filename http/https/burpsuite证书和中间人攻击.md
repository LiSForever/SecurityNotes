### burpsuite证书和中间人攻击

> 浏览器安装了burpsuite证书后可以进行https的抓包，这实际上等同于burpsuite进行了中间人攻击。

浏览器和服务器正常的https通信：

* 浏览器向服务器明文请求证书
* 服务器返回证书，证书包括服务器的信息、服务器的公钥、签发机构的信息、签发机构的签名
* 浏览器利用系统预装的机构证书的公钥对服务器端发送的证书进行验证，确定是合法证书，确保通信的目标真的是服务器，并得到服务器的公钥
* 浏览器产生对称加密的秘钥，并用服务器公钥加密该对称秘钥，发送给服务器

中间人攻击：中间人在浏览器和服务器端劫持双方的会话，对于服务器端，中间人伪装成成客户端，对于客户端，中间人伪装成服务器端。但存在一个问题，中间人伪装成客户端可以得到服务器的公钥，但得不到服务器的私钥，因此无法解密得到客户端使用服务器公钥加密的对称加密秘钥，因此无法监听后续客户端与服务器的信息交互。所以要想完成攻击，中间人对于客户端必须完整的冒充成服务器，需要有自己的证书：

* 浏览器和服务器的会话被中间人劫持
* 浏览器向服务器明文请求证书
* 服务器端返回证书，中间人拦截返回证书，并返回自己的证书给浏览器
* 浏览器使用系统预装的机构证书的公钥对服务器端发送的证书进行验证，一般情况下中间人的证书都不合法，但是如果像我们使用burpsuite一样在系统上安装了中间人的证书，就能通过合法性验证，得到中间人公钥
* 浏览器产生对称加密秘钥，利用中间人的公钥加密，发送给服务器
* 中间人继续劫持客户端发送的消息，利用自己的私钥解密，然后用服务器公钥加密发送给服务器